{"remainingRequest":"C:\\Users\\Marc\\source\\repos\\openESEA\\openESEA_interpreter\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\Marc\\source\\repos\\openESEA\\openESEA_interpreter\\frontend\\src\\views\\organisation\\OrganisationDashboard.vue?vue&type=template&id=05816f42","dependencies":[{"path":"C:\\Users\\Marc\\source\\repos\\openESEA\\openESEA_interpreter\\frontend\\src\\views\\organisation\\OrganisationDashboard.vue","mtime":1708979735272},{"path":"C:\\Users\\Marc\\source\\repos\\openESEA\\openESEA_interpreter\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1741014584802},{"path":"C:\\Users\\Marc\\source\\repos\\openESEA\\openESEA_interpreter\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1741014593746},{"path":"C:\\Users\\Marc\\source\\repos\\openESEA\\openESEA_interpreter\\frontend\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1741014602863},{"path":"C:\\Users\\Marc\\source\\repos\\openESEA\\openESEA_interpreter\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1741014584802},{"path":"C:\\Users\\Marc\\source\\repos\\openESEA\\openESEA_interpreter\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1741014595374}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoNCiAgICA8IS0tIERhc2hib2FyZCAtLT4NCiAgICA8ZGl2IGNsYXNzPSJvcmdhbmlzYXRpb24tZGFzaGJvYXJkIiByZWY9ImRhc2hib2FyZCI+DQoNCiAgICAgICAgPCEtLSBTaG93IHNwaW5uZXIgd2hpbGUgbG9hZGluZyBkYXNoYm9hcmQgLS0+DQogICAgICAgIDxkaXYgdi1pZj0iIWRhc2hib2FyZExvYWRlZCIgY2xhc3M9InNwaW5uZXItZGl2Ij4NCiAgICAgICAgICAgIDxQcm9ncmVzc1NwaW5uZXIgY2xhc3M9ImNlbnRlci1zcGlubmVyIj48L1Byb2dyZXNzU3Bpbm5lcj4NCiAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgPCEtLSBJZiBkYXNoYm9hcmQgaXMgbG9hZGVkLCBzaG93IGRhc2hib2FyZCBhbmQgZWRpdGluZyBzZWN0aW9uIC0tPg0KICAgICAgICA8ZGl2IHYtZWxzZT4NCiAgICAgICAgICAgIDwhLS0gRWRpdGluZyBTZWN0aW9uIC0tPg0KICAgICAgICAgICAgPERhc2hib2FyZEVkaXRpbmdTZWN0aW9uIEBzYXZlQnV0dG9uQ2xpY2tlZD0ic2F2ZURhc2hib2FyZFRvRGF0YWJhc2UiIEBkaXNjYXJkQnV0dG9uQ2xpY2tlZD0iZGlzY2FyZENoYW5nZXMiPjwvRGFzaGJvYXJkRWRpdGluZ1NlY3Rpb24+DQogICAgICAgICAgICA8IS0tIEFjdHVhbCBkYXNoYm9hcmQgLS0+DQogICAgICAgICAgICA8RGFzaGJvYXJkPjwvRGFzaGJvYXJkPg0KDQogICAgICAgICAgICA8IS0tIERpYWxvZyBzaG93aW5nIHRoYXQgdGhlcmUgYXJlIHVuc2F2ZWQgY2hhbmdlcyAtLT4NCiAgICAgICAgICAgIDxEaWFsb2cgcmVmPSJkaWFsb2ciIHYtbW9kZWw6dmlzaWJsZT0ic2hvd0RpYWxvZyIgbW9kYWwNCiAgICAgICAgICAgICAgICA6aGVhZGVyPSInVGhlcmUgYXJlIHVuc2F2ZWQgY2hhbmdlcyB0byB0aGUgZGFzaGJvYXJkLiBEbyB5b3Ugd2FudCB0byBzYXZlIHRoZXNlIGNoYW5nZXM/JyI+DQoNCiAgICAgICAgICAgICAgICA8IS0tIEZvb3RlciB3aXRoIGJ1dHRvbnMgZm9yIG9wdGlvbnM6IENhbmNlbCwgRGlzY2FyZCBDaGFuZ2VzLCBTYXZlIENoYW5nZXMgLS0+DQogICAgICAgICAgICAgICAgPHRlbXBsYXRlICNmb290ZXI+DQogICAgICAgICAgICAgICAgICAgIDxCdXR0b24gbGFiZWw9IkNhbmNlbCIgaWNvbj0icGkgcGktdGltZXMiDQogICAgICAgICAgICAgICAgICAgICAgICBAY2xpY2s9ImNsb3NlRGlhbG9nIiB0ZXh0Pg0KICAgICAgICAgICAgICAgICAgICA8L0J1dHRvbj4NCiAgICAgICAgICAgICAgICAgICAgPEJ1dHRvbiBsYWJlbD0iRGlzY2FyZCBDaGFuZ2VzIiBpY29uPSJwaSBwaS10cmFzaCIgY2xhc3M9InAtYnV0dG9uLWRhbmdlciBwLWJ1dHRvbi1zbSINCiAgICAgICAgICAgICAgICAgICAgICAgIEBjbGljaz0iZGlzY2FyZENoYW5nZXMiIHRleHQ+DQogICAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIGxhYmVsPSJTYXZlIENoYW5nZXMiIGljb249InBpIHBpLWNoZWNrIiBjbGFzcz0icC1idXR0b24tc3VjY2VzcyBwLWJ1dHRvbi1zbSINCiAgICAgICAgICAgICAgICAgICAgICAgIEBjbGljaz0ic2F2ZUNoYW5nZXMiIGF1dG9mb2N1cz4NCiAgICAgICAgICAgICAgICAgICAgPC9CdXR0b24+DQogICAgICAgICAgICAgICAgPC90ZW1wbGF0ZT4NCg0KICAgICAgICAgICAgPC9EaWFsb2c+DQoNCiAgICAgICAgPC9kaXY+DQoNCiAgICA8L2Rpdj4NCg0K"},{"version":3,"sources":["C:\\Users\\Marc\\source\\repos\\openESEA\\openESEA_interpreter\\frontend\\src\\views\\organisation\\OrganisationDashboard.vue"],"names":[],"mappings":";;IAEI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;IACjB,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;QAE/C,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;QAC5C,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAC5C,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC7D,CAAC,CAAC,CAAC,CAAC,CAAC;;QAEL,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;QAClE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YACvB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACtI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YACxB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;YAEtB,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YACrD,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;gBAClD,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;gBAE1F,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;gBAC9E,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACb,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;wBACpC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;oBAC7B,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACR,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;wBACjF,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;oBAChC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACR,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;wBAC/E,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAClC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACZ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;YAEd,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;QAEZ,CAAC,CAAC,CAAC,CAAC,CAAC;;IAET,CAAC,CAAC,CAAC,CAAC,CAAC","file":"C:/Users/Marc/source/repos/openESEA/openESEA_interpreter/frontend/src/views/organisation/OrganisationDashboard.vue","sourceRoot":"","sourcesContent":["<template>\r\n\r\n    <!-- Dashboard -->\r\n    <div class=\"organisation-dashboard\" ref=\"dashboard\">\r\n\r\n        <!-- Show spinner while loading dashboard -->\r\n        <div v-if=\"!dashboardLoaded\" class=\"spinner-div\">\r\n            <ProgressSpinner class=\"center-spinner\"></ProgressSpinner>\r\n        </div>\r\n\r\n        <!-- If dashboard is loaded, show dashboard and editing section -->\r\n        <div v-else>\r\n            <!-- Editing Section -->\r\n            <DashboardEditingSection @saveButtonClicked=\"saveDashboardToDatabase\" @discardButtonClicked=\"discardChanges\"></DashboardEditingSection>\r\n            <!-- Actual dashboard -->\r\n            <Dashboard></Dashboard>\r\n\r\n            <!-- Dialog showing that there are unsaved changes -->\r\n            <Dialog ref=\"dialog\" v-model:visible=\"showDialog\" modal\r\n                :header=\"'There are unsaved changes to the dashboard. Do you want to save these changes?'\">\r\n\r\n                <!-- Footer with buttons for options: Cancel, Discard Changes, Save Changes -->\r\n                <template #footer>\r\n                    <Button label=\"Cancel\" icon=\"pi pi-times\"\r\n                        @click=\"closeDialog\" text>\r\n                    </Button>\r\n                    <Button label=\"Discard Changes\" icon=\"pi pi-trash\" class=\"p-button-danger p-button-sm\"\r\n                        @click=\"discardChanges\" text>\r\n                    </Button>\r\n                    <Button label=\"Save Changes\" icon=\"pi pi-check\" class=\"p-button-success p-button-sm\"\r\n                        @click=\"saveChanges\" autofocus>\r\n                    </Button>\r\n                </template>\r\n\r\n            </Dialog>\r\n\r\n        </div>\r\n\r\n    </div>\r\n\r\n</template>\r\n\r\n<script>\r\nimport { isEqual, cloneDeep } from 'lodash'\r\n\r\nimport { mapState, mapGetters, mapMutations, mapActions } from 'vuex'\r\n\r\nimport EseaAccountService from '../../services/EseaAccountService.js'\r\nimport SurveyResponseService from '../../services/SurveyResponseService.js'\r\nimport DirectIndicatorService from '../../services/DirectIndicatorService.js'\r\nimport IndirectIndicatorService from '../../services/IndirectIndicatorService.js'\r\n\r\nimport Dashboard from '../../components/dashboard/Dashboard.vue'\r\nimport DashboardEditingSection from '../../components/dashboard/DashboardEditingSection.vue'\r\n\r\nimport ProgressSpinner from 'primevue/progressspinner'\r\nimport Dialog from 'primevue/dialog'\r\n\r\nexport default {\r\n    components: {\r\n        DashboardEditingSection,\r\n        Dashboard,\r\n\r\n        ProgressSpinner,\r\n        Dialog\r\n    },\r\n    data () {\r\n        return {\r\n            // Route parameters for organisation and dashboard ids\r\n            organisationId: this.$route.params.OrganisationId,\r\n            dashboardId: this.$route.params.DashboardId,\r\n\r\n            dashboardLoaded: false,\r\n\r\n            initialDashboard: null,\r\n\r\n            showDialog: false,\r\n\r\n            fetchSuggestionsTimer: null,\r\n\r\n            testing: true\r\n        }\r\n    },\r\n    computed: {\r\n        // ...mapState('network', ['networks']),\r\n        ...mapState('organisation', ['organisation']),\r\n        ...mapState('dashboardModel', ['dashboard', 'selectionConfig']),\r\n            permission () {\r\n                if (this.organisation.accesLevel) {\r\n                    const accesLevel = this.organisation.accesLevel\r\n                    if (accesLevel === 'admin' || accesLevel === 'network admin') {\r\n                        return true\r\n                    }\r\n                }\r\n                return false\r\n            }\r\n    },\r\n    watch: {\r\n        dashboard: {\r\n            handler: 'updateRLModel',\r\n            deep: true\r\n        }\r\n    },\r\n    async mounted () {\r\n        if (!this.testing) {\r\n            this.fetchSuggestionsTimer = setInterval(this.fetchDashboardSuggestions, 10000)\r\n        }\r\n    },\r\n    async unmounted () {\r\n        if (!this.testing) {\r\n            clearInterval(this.fetchSuggestionsTimer)\r\n        }\r\n    },\r\n    async beforeUnmount () {\r\n        window.removeEventListener('beforeunload', this.unload)\r\n    },\r\n    async created () {\r\n        window.addEventListener('beforeunload', this.unload)\r\n\r\n        // Fetch latest version of dashboard\r\n        await this.fetchDashboard({ id: parseInt(this.dashboardId) })\r\n        // Load dashboard from fetched dashboard\r\n        await this.loadDashboardFromDatabase()\r\n        await this.setInitialDashboard()\r\n\r\n        // Initialize RL model\r\n        if (!this.testing) {\r\n            await this.initializeRLModel()\r\n        }\r\n    },\r\n    async beforeRouteLeave (to, from, next) {\r\n        console.log('Leaving route')\r\n        if (!this.dashboardLoaded) next(true)\r\n        if (!this.dashboardSaved()) {\r\n            this.showDialog = true\r\n            next(false)\r\n        } else {\r\n            if (!this.testing) {\r\n                await this.stopRLModel()\r\n            }\r\n            next(true)\r\n        }\r\n    },\r\n    methods: {\r\n        ...mapGetters('dashboard', ['getDashboard', 'getDashboards']),\r\n        ...mapActions('dashboard', ['setDashboard', 'updateDashboard', 'fetchDashboard']),\r\n\r\n        ...mapGetters('dashboardData', ['getIndicatorDataSets', 'getIndicatorFields', 'getIndicators', 'getVisualisationDatasets']),\r\n        ...mapMutations('dashboardData', ['setIndicators', 'setIndicatorData', 'setIndicatorFields']),\r\n        ...mapActions('dashboardData', ['createIndicatorDataSets']),\r\n\r\n        ...mapGetters('dashboardModel', ['getDashboardModel', 'getMethods', 'getOverview', 'getContainers', 'getVisualisations', 'getVisualisationTitle', 'getVisualisationType', 'getCategoryLimit']),\r\n        ...mapActions('dashboardModel', ['createDashboardModel']),\r\n\r\n        ...mapActions('dashboardSuggestions', ['buildDashboardRLModel', 'updateDashboardRLModel', 'deleteDashboardRLModel', 'fetchDashboardSuggestions']),\r\n\r\n        setInitialDashboard () {\r\n            this.initialDashboard = cloneDeep(this.dashboard)\r\n        },\r\n        dashboardSaved () {\r\n            return isEqual(this.dashboard, this.initialDashboard)\r\n        },\r\n\r\n        async unload (event) {\r\n            console.log('Unloading page')\r\n            if (!this.dashboardLoaded) return\r\n            // Prevent page unloading if dashboard is not saved\r\n            if (!this.dashboardSaved()) {\r\n                event.preventDefault()\r\n                event.returnValue = '' // Required for older browsers\r\n            }\r\n        },\r\n        async initializeRLModel () {\r\n            // Wait 2 seconds before visualisations are loaded\r\n            const sleep = (delay) => new Promise((resolve) => setTimeout(resolve, delay))\r\n            console.log('datasets:')\r\n            console.log(await this.getIndicatorDataSets()())\r\n            await sleep(2000)\r\n            // Build new RL Model and set interval for fetching suggestions\r\n            const dashboard = await this.collectDashboardInfo()\r\n            console.log(dashboard)\r\n            if (!this.testing) {\r\n                await this.buildDashboardRLModel({ data: { dashboard: dashboard } })\r\n            }\r\n        },\r\n        async collectDashboardInfo () {\r\n            // Initialize list with info for all visualisations\r\n            var visualisationInfoList = []\r\n\r\n            // Select current overview\r\n            const overviewId = this.selectionConfig?.overviewId\r\n            var selectionConfigCurrent = { overviewId: overviewId }\r\n\r\n            // Get all containers with possible visualisations, if no containers, return\r\n            const containers = await this.getContainers()(selectionConfigCurrent)\r\n            if (!containers) return visualisationInfoList\r\n\r\n            // Dashboard size\r\n            const dashboardWidth = this.$refs.dashboard.clientWidth\r\n            const dashboardHeight = this.$refs.dashboard.clientHeight\r\n            const dashboardDisplayArea = dashboardWidth * dashboardHeight\r\n\r\n            // Get visualisation datasets\r\n            var visualisationDatasets = await this.getVisualisationDatasets()()\r\n            // Collect visualisations for each container\r\n            for (let containerId = 0; containerId < containers.length; containerId++) {\r\n                const containerPosition = containers[containerId].Position\r\n                const containerWidth = (containerPosition['X End'] - containerPosition['X Start']) * dashboardWidth / 100\r\n                const containerHeight = (containerPosition['Y End'] - containerPosition['Y Start']) * dashboardHeight / 100\r\n\r\n                // Update selection to current conainer\r\n                selectionConfigCurrent.containerId = containerId\r\n                // Get all visualisation for this container\r\n                const visualisations = await this.getVisualisations()(selectionConfigCurrent)\r\n                // Get info for each visualisation\r\n                for (let visualisationId = 0; visualisationId < visualisations.length; visualisationId++) {\r\n                    const visualisationPosition = visualisations[visualisationId].Position\r\n                    const xStartPixels = dashboardWidth * containerPosition['X Start'] + containerWidth * visualisationPosition['X Start']\r\n                    const xEndPixels = dashboardWidth * containerPosition['X End'] + containerWidth * visualisationPosition['X End']\r\n                    const yStartPixels = dashboardHeight * containerPosition['Y Start'] + containerHeight * visualisationPosition['Y Start']\r\n                    const yEndPixels = dashboardHeight * containerPosition['Y End'] + containerHeight * visualisationPosition['Y End']\r\n                    const visualisationDisplayArea = (xEndPixels - xStartPixels) * (yEndPixels - yStartPixels)\r\n\r\n                    // Update selection to current visualisation\r\n                    selectionConfigCurrent.visualisationId = visualisationId\r\n\r\n                    // Get dataset for this visualisation\r\n                    var visualisationData = null\r\n\r\n                    for (const visualisationDataset of visualisationDatasets) {\r\n                        const config = visualisationDataset.config\r\n                        const dataset = visualisationDataset.dataset\r\n                        if (isEqual(config, selectionConfigCurrent)) {\r\n                            visualisationData = dataset\r\n                            break\r\n                        }\r\n                    }\r\n\r\n                    // Get visualisation type\r\n                    const visualisationType = await this.getVisualisationType()(selectionConfigCurrent)\r\n                    const visualisationTitle = await this.getVisualisationTitle()(selectionConfigCurrent)\r\n                    const categoryLimit = await this.getCategoryLimit()(selectionConfigCurrent)\r\n\r\n                    const categoryField = Object.keys(visualisationData?.mapping).find(fieldKey => fieldKey === 'Category Field')\r\n                    const allCategories = categoryField ? visualisationData?.data?.map(row => row[categoryField]) : []\r\n                    const distinctCategories = new Set(allCategories)\r\n\r\n                    const numberOfCategories = distinctCategories?.size\r\n                    const numberOfDataPoints = visualisationData?.data?.length ?? 0\r\n                    const amountOfValueFields = Object.keys(visualisationData?.mapping).filter(fieldKey => fieldKey.includes('Value Field')).length\r\n\r\n                    // Gather all visualisation information into one object\r\n                    var visualisationInfo = {}\r\n                    visualisationInfo['Selection Configuration'] = cloneDeep(selectionConfigCurrent) // For applying this to the correct visualisation\r\n                    visualisationInfo['Visualisation Type'] = visualisationType\r\n                    visualisationInfo['Visualisation Title'] = visualisationTitle\r\n                    visualisationInfo['Category Items'] = numberOfCategories\r\n                    visualisationInfo['Data Items'] = numberOfDataPoints * amountOfValueFields\r\n                    visualisationInfo['Item Limit Enabled'] = categoryLimit > 0\r\n                    visualisationInfo['Item Limit'] = categoryLimit ?? 0\r\n                    visualisationInfo['Display Area'] = visualisationDisplayArea\r\n                    visualisationInfo.Position = { 'X Start': xStartPixels, 'X End': xEndPixels, 'Y Start': yStartPixels, 'Y End': yEndPixels }\r\n                    visualisationInfoList.push(visualisationInfo)\r\n                }\r\n            }\r\n            return { Visualisations: visualisationInfoList, 'Display Area': dashboardDisplayArea }\r\n        },\r\n        async updateRLModel () {\r\n            if (this.testing) return\r\n            // Wait 2 seconds before visualisations are loaded\r\n            const sleep = (delay) => new Promise((resolve) => setTimeout(resolve, delay))\r\n            await sleep(2000)\r\n            // Update RL Model and set interval for fetching suggestions\r\n            const dashboard = await this.collectDashboardInfo()\r\n            await this.updateDashboardRLModel({ data: { dashboard: dashboard } })\r\n            // Reset timer for fetching suggestions\r\n            if (!this.testing) {\r\n                clearInterval(this.fetchSuggestionsTimer)\r\n                this.fetchSuggestionsTimer = setInterval(this.fetchDashboardSuggestions, 10000)\r\n            }\r\n        },\r\n        async stopRLModel () {\r\n            // Delete RL model and clear timer\r\n            await this.deleteDashboardRLModel({ data: {} })\r\n            clearInterval(this.fetchSuggestionsTimer)\r\n        },\r\n        async saveChanges () {\r\n            await this.saveDashboardToDatabase()\r\n            this.closeDialog()\r\n        },\r\n        async discardChanges () {\r\n            const oldDashboard = cloneDeep(this.initialDashboard)\r\n            await this.loadDashboardModel(oldDashboard)\r\n            this.closeDialog()\r\n        },\r\n        closeDialog () {\r\n            this.showDialog = false\r\n        },\r\n\r\n        async loadDashboardFromDatabase () {\r\n            // Load dashboard from database\r\n            const dashboard = await this.getDashboard()\r\n            // Set as current dashboard\r\n            await this.setDashboard(dashboard)\r\n\r\n            // Get dashboard model specification\r\n            const model = dashboard.specification\r\n            // Load dashboard model\r\n            await this.loadDashboardModel(model)\r\n            // Load dashboard data\r\n            await this.loadDashboardData()\r\n            // When everything is ready show dashboard\r\n            this.dashboardLoaded = true\r\n        },\r\n        async saveDashboardToDatabase () {\r\n            if (!this.permission) {\r\n                console.log('No permission to save dashboards!')\r\n                return\r\n            } else {\r\n                console.log('Permission to save dashboard!')\r\n            }\r\n            // Get current dashboard model\r\n            const dashboardModel = await this.getDashboardModel()()\r\n            // Combine dashboard id with dashboard model specification\r\n            const dashboardId = parseInt(this.dashboardId)\r\n            const data = { id: dashboardId, data: dashboardModel }\r\n            // Send this data to update the dashboard in the database\r\n            await this.updateDashboard(data)\r\n            // Signal that changes are saved\r\n            await this.setInitialDashboard()\r\n        },\r\n        async loadDashboardModel (model) {\r\n            // Force reload by first setting model to null\r\n            await this.createDashboardModel(null)\r\n            // Then set dashboard model\r\n            const payload = { value: model }\r\n            await this.createDashboardModel(payload)\r\n        },\r\n        async loadDashboardData () {\r\n            // Retrieve and save all indicators of the given methods\r\n            const indicators = await this.retrieveIndicators()\r\n            await this.setIndicators(indicators)\r\n\r\n            // Retrieve and save all data for the indicators of the given methods\r\n            const indicatorData = await this.retrieveIndicatorData()\r\n            await this.setIndicatorData(indicatorData)\r\n\r\n            // Create data sets for each indicator\r\n            await this.createIndicatorDataSets()\r\n        },\r\n        async retrieveIndicators () {\r\n            const methodIds = await this.getMethods()()\r\n            var indicators = []\r\n            for (var methodId of methodIds) {\r\n                const directIndicators = await DirectIndicatorService.get({ mId: methodId })\r\n                console.log(directIndicators)\r\n                if (!directIndicators?.error || directIndicators?.error?.response?.status === 404) {\r\n                    for (var directIndicator of (directIndicators?.response?.data || [])) {\r\n                        indicators.push(directIndicator)\r\n                    }\r\n                }\r\n                const indirectIndicators = await IndirectIndicatorService.get({ mId: methodId })\r\n                console.log(indirectIndicators)\r\n                if (!indirectIndicators?.error || indirectIndicators?.error?.response?.status === 404) {\r\n                    for (var indirectIndicator of (indirectIndicators?.response?.data || [])) {\r\n                        indicators.push(indirectIndicator)\r\n                    }\r\n                }\r\n            }\r\n            // console.log(indicators)\r\n            indicators = indicators?.map(el => ({ name: el.name, key: el.key }))\r\n            return indicators\r\n        },\r\n        async retrieveIndicatorData () {\r\n            // Determine current organisation and targeted methods for dashboard\r\n            const methodIds = await this.getMethods()()\r\n            const organisationId = this.organisationId\r\n\r\n            /* Get the data from the esea accounts of the current organisation (by looking at the question responses in the survey responses) */\r\n            var eseaData = []\r\n\r\n            // Get esea accounts for this organisation\r\n            const eseaAccountsRequest = await EseaAccountService.get({ oId: organisationId })\r\n            if (eseaAccountsRequest.error) return\r\n            const eseaAccounts = eseaAccountsRequest.response.data\r\n\r\n            // Loop over esea accounts\r\n            for (var eseaAccount of eseaAccounts) {\r\n                const eseaAccountId = eseaAccount.id\r\n                // Get year and method of this esea account\r\n                const eseaAccountYear = eseaAccount.year\r\n                const eseaMethod = eseaAccount.method\r\n\r\n                // If this esea account is not for a targeted method, skip this esea account\r\n                if (!methodIds.includes(eseaMethod)) continue\r\n\r\n                // Get all survey responses for this esea account\r\n                const surveyResponseRequest = await SurveyResponseService.get({ oId: organisationId, eaId: eseaAccountId })\r\n                if (surveyResponseRequest.error) continue\r\n                const surveyResponses = surveyResponseRequest.response.data\r\n\r\n                // Loop over survey responses\r\n                for (var surveyResponse of surveyResponses) {\r\n                    // Get responses to questions\r\n                    const questionResponses = surveyResponse.question_responses\r\n\r\n                    // Loop over all questions\r\n                    for (var questionResponse of questionResponses) {\r\n                        // Retrieve indicator data and the given values\r\n                        const directIndicatorKey = questionResponse.direct_indicator_key\r\n                        const directIndicatorValue = questionResponse.value ?? questionResponse.values\r\n                        const multipleChoice = questionResponse.value === null\r\n\r\n                        // Store indicator data\r\n                        eseaData.push({\r\n                            'Indicator Key': directIndicatorKey,\r\n                            Value: directIndicatorValue,\r\n                            Year: eseaAccountYear,\r\n                            'Multiple Choice': multipleChoice\r\n                            // 'Esea Account Id': eseaAccountId,\r\n                            // 'Method Id': eseaMethod,\r\n                            // 'Indicator Id': directIndicatorId\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Return the data for all indicators\r\n            return eseaData\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n.organisation-dashboard {\r\n    min-height: 600px;\r\n    position: relative;\r\n\r\n    font-family: Arial, Helvetica, sans-serif;\r\n    height: 100%;\r\n\r\n    /* Handle edit area element */\r\n    --edit-area-width: 200px;\r\n    --edit-area-current-width: 0px;\r\n    --edit-sidebar-width: 20px;\r\n}\r\n.spinner-div {\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n</style>\r\n"]}]}